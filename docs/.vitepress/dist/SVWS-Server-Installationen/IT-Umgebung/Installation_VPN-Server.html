<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Installation des VPN-Servers | SVWS Dokumentation</title>
    <meta name="description" content="Just playing around.">
    <link rel="stylesheet" href="/assets/style.2759ba08.css">
    <link rel="modulepreload" href="/assets/plugin-vue_export-helper.68280688.js">
    <link rel="modulepreload" href="/assets/Home.95c605b2.js">
    <link rel="modulepreload" href="/assets/SVWS-Server-Installationen_IT-Umgebung_Installation_VPN-Server.md.c70544e5.lean.js">
    <link rel="modulepreload" href="/assets/app.7749d780.js">
    
    <meta name="twitter:title" content="Installation des VPN-Servers | SVWS Dokumentation">
  <meta property="og:title" content="Installation des VPN-Servers | SVWS Dokumentation">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="SVWS Dokumentation, back to home" data-v-675d8756 data-v-4a583abe><!----> SVWS Dokumentation</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><!----></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><!----><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><p class="sidebar-link-item">Entwicklungsumgebungen</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/Entwicklungsumgebungen/Eclipse-Ubuntu/">Eclipse-Ubuntu</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/Entwicklungsumgebungen/Eclipse-Windows/">Eclipse-Windows</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/Entwicklungsumgebungen/Eclipse-Windows_im_MSB/">Eclipse-Windows_im_MSB</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/Entwicklungsumgebungen/Multipass/">Multipass</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/Entwicklungsumgebungen/VS-Code/">VS-Code</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/Entwicklungsumgebungen/macOS/">macOS</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/Gitlab-Server/">Gitlab-Server</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/Lizenz-Informationen/">Lizenz-Informationen</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/Reporting/">Reporting</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/SVWS-Client/">SVWS-Client</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/SVWS-Installer/">SVWS-Installer</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/SVWS-Server/">SVWS-Server</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/SVWS-Server/svws-db/">svws-db</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/SVWS-Server-Installationen/">SVWS-Server-Installationen</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/SVWS-UI-Framework/">SVWS-UI-Framework</a><!----></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="installation-des-vpn-servers" tabindex="-1">Installation des VPN-Servers <a class="header-anchor" href="#installation-des-vpn-servers" aria-hidden="true">#</a></h1><h2 id="vorbereitungen" tabindex="-1">Vorbereitungen <a class="header-anchor" href="#vorbereitungen" aria-hidden="true">#</a></h2><h3 id="auswahl-der-maschine" tabindex="-1">Auswahl der Maschine <a class="header-anchor" href="#auswahl-der-maschine" aria-hidden="true">#</a></h3><p>Es gibt mehrer M�glichkeiten wie ein VPN-Server betrieben werden kann:</p><ul><li>in einer Virtualisierungsumgebung (Proxmox, ESXi, ...)</li><li>im Containersystem (Docker, LXH, ...)</li><li>direkt auf echter Hardware (Raspberry, PC, Server ...)</li><li>im Router (Fritzbox, ...)</li><li>als Teil einer Firewall (OpenSense, ...)</li></ul><h3 id="beipiele-f�r-hardwarel�sungen" tabindex="-1">Beipiele f�r Hardwarel�sungen: <a class="header-anchor" href="#beipiele-f�r-hardwarel�sungen" aria-hidden="true">#</a></h3><p>Hier gibt es mehrer Anbieter, die auch Hardwarel�sungen anbieten. Ein paar wenige Beispiele sind hier nach kurzer Suche im Internet exemplarisch zu finden:</p><p>Fritzbox: <br><a href="https://www.computerbild.de/artikel/cb-News-Software-FritzOS-7.39-AVM-integriert-WireGuard-VPN-FritzBox-31230305.html" target="_blank" rel="noopener noreferrer">https://www.computerbild.de/artikel/cb-News-Software-FritzOS-7.39-AVM-integriert-WireGuard-VPN-FritzBox-31230305.html</a></p><p>Shellfire: <br><a href="https://www.shellfire.de/blog/shellfire-box-4k-wireguard-vpn-router-power/" target="_blank" rel="noopener noreferrer">https://www.shellfire.de/blog/shellfire-box-4k-wireguard-vpn-router-power/</a></p><p>OpenSense: <br><a href="https://www.ovpn.com/de/guides/wireguard/opnsense" target="_blank" rel="noopener noreferrer">https://www.ovpn.com/de/guides/wireguard/opnsense</a></p><h2 id="wireguard-vpn-server" tabindex="-1">WireGuard VPN-Server <a class="header-anchor" href="#wireguard-vpn-server" aria-hidden="true">#</a></h2><p>Die Entscheidung f�r den Wireguard VPN-Server in der Testumgebung des SVWS-Servers ist aufgrund verschiedener Rahmenbedingungen gefallen:</p><ul><li>performant, da fest im Linux-Kernel verankert</li><li>Open Source</li><li>einfache Installation per Skript</li><li>installierbar auf einem Server oder einer virtuellen Maschine</li><li>ebenfalls als Hardware erh�ltlich</li><li>einfache Wartung und Konfiguration per script</li><li>m�gliche Weiterentwicklung (Konfiguration der VPN-Zug�nge von au�en)</li></ul><p>Im Weitern wird als Basis eine virtuelle Debian 11 Maschine auf einem Proxmoxsystem verwendet.</p><p>Ebenso ist die installation in einem LXH-Container m�glich, jedoch mit einigen Konfigurationen auf dem Muttersystem verbunden, auf die hier nicht weiter eingegangen wird. Die Installation unterscheidet sich im Wesentlichen nicht von anderen Installationen auf anderen Virtualisierungen (ESXi, ...) oder echter Hardware.</p><h3 id="installation-des-debian-11-system" tabindex="-1">Installation des Debian 11 System <a class="header-anchor" href="#installation-des-debian-11-system" aria-hidden="true">#</a></h3><h4 id="download-debian-11-net-install" tabindex="-1">download debian 11 net install: <br> <a class="header-anchor" href="#download-debian-11-net-install" aria-hidden="true">#</a></h4><p><a href="https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-11.1.0-amd64-netinst.iso" target="_blank" rel="noopener noreferrer">https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-11.1.0-amd64-netinst.iso</a></p><p>Eine typische Debian Installation ausf�hren - einfach der Menuef�hrung folgen und je nach Bedarf auch auf das grafische Frontend verzichten. Den SSH-Server direkt mit installieren, es wird in der Regel der SSH Zugang f�r die Wartung ben�tigt.</p><h4 id="ggf-aktualisieren" tabindex="-1">ggf aktualisieren <a class="header-anchor" href="#ggf-aktualisieren" aria-hidden="true">#</a></h4><p>Bei einem frisch installierten System sollte dieser Schritt nicht n�tig sein, man kann es aber trotzdem einmal ausf�hren, um auch die letzten Aktualisierungen geladen zu haben:</p><pre><code>	apt update
	apt upgrade -y
</code></pre><p>N�tzliche Helfer installieren:</p><pre><code>	apt install -y nmap curl git net-tools
</code></pre><h4 id="ggf-das-root-login-per-ssh-zulassen" tabindex="-1">ggf das root login per ssh zulassen: <a class="header-anchor" href="#ggf-das-root-login-per-ssh-zulassen" aria-hidden="true">#</a></h4><p>Wenn man eine Fernsteuerung des Wireguard-Servers �ber SSH zulassen m�chte sollte eine Anmeldung per root Account zumindest aus dem lokalen Netz heraus erm�glicht werden. Der ssh-root-login ist ohnehin in vielen Debian Installationen schon aktiviert, dies ist jedoch im Grunde ein vermeidbares Sicherheitsrisiko bei Maschinen, die auf diesem Port �ber das Internet erreichbar sind. Abhilfe schafft hier entweder das Abschalten des rootlogins, eine vorgelagerte Firewall oder die Absicherung zum Beispiel mit <a href="https://www.thomas-krenn.com/de/wiki/SSH_Login_unter_Debian_mit_fail2ban_absichern" target="_blank" rel="noopener noreferrer">fail2ban</a>.</p><p>Falls der ssh-root-login zugelassen werden soll, muss die Datei sshd_config editiert werden:</p><pre><code>	nano /etc/ssh/sshd_config
</code></pre><p>unter der auskommentierten Zeile</p><pre><code>	#PermitRootLogin prohibit-password
</code></pre><p>Folgendes einf�gen:</p><pre><code>	PermitRootLogin yes
</code></pre><p>SSH neu starten:</p><pre><code>	sudo service sshd restart
</code></pre><h2 id="installation-von-wireguard-per-script" tabindex="-1">Installation von Wireguard per Script <a class="header-anchor" href="#installation-von-wireguard-per-script" aria-hidden="true">#</a></h2><p>Download des Installationsscrpits und Installation starten:</p><pre><code>	wget https://git.io/wireguard -O wireguard-install.sh &amp;&amp; bash wireguard-install.sh
</code></pre><p>(Quellen werden noch nachgearbeitet.) Als Port kann auch irgendein Port in den h�heren Bereichen gew�hlt werden, wie hier dargestellt port 58200.</p><p><img src="/assets/wireguard_1.15f0f3cd.png" alt="Wireguard Installation Screenshot"></p><p>(Die Nachfrage zum Installieren von BoringTun erfolgt nur bei LXH-Containern.)</p><h2 id="portfreigabe" tabindex="-1">Portfreigabe <a class="header-anchor" href="#portfreigabe" aria-hidden="true">#</a></h2><p>Um nun den Wireguard-Server aus dem Internet erreichen zu k�nnen und dar�ber eine VPN-Verbindung ins eigene Verwaltungsnetz herzustellen, ben�tigt man eine Portfreigabe auf dem Router bzw. der eingesetzten Firewall. Dies muss in der Regel durch den zust�ndigen IT-Dienstleister eingerichtet werden. Exemplarisch wird hier die <a href="./Einrichtung_Portfreigabe.html">Einrichtung einer Portfreigabe bei einer Fritzbox</a> gezeigt.</p><h2 id="fernsteuerung-per-ssh" tabindex="-1">Fernsteuerung per ssh <a class="header-anchor" href="#fernsteuerung-per-ssh" aria-hidden="true">#</a></h2><p>Die Einrichtung der <em>Fernsteuerung per ssh</em> erm�glicht es auf dem SVWS-Server durch Absetzen einfacher Befehle VPN Verbindungen zu verwalten. Im Folgenden wird die Arbeit �ber die Konsole des SVWS-Servers ausgef�hrt.</p><h3 id="ssh-autologin-einrichten" tabindex="-1">SSH autologin einrichten <a class="header-anchor" href="#ssh-autologin-einrichten" aria-hidden="true">#</a></h3><p>Auf dem SVWS-Server als SVWS-Standart-Benutzer einen permanenten ssh Schl�ssel mit dem Maschine <em>wireguard</em> austauschen:</p><pre><code>	ssh-keygen -t rsa -b 4096
	ssh-copy-id -i ~/.ssh/id_rsa.pub root@wireguard
</code></pre><p>Nun k�nnen Root Befehle auf dem Wireguard-Server auch vom SVWS-Server aus abgesetzt werden.</p><h3 id="wireguard-user-einrichten" tabindex="-1">wireguard_user einrichten <a class="header-anchor" href="#wireguard-user-einrichten" aria-hidden="true">#</a></h3><p>Um einfach Wireguard-user einzurichten kann der Befehl wirguard_user benutzt werden. Dieses Skript muss jedoch erst einmal heruntergeladen und als ausf�hrbare Datei im Wirguard-Server etabliert werden.</p><pre><code>	ssh root@wireguard
	git clone https://github.com/familie-klein/wireguard_user/
</code></pre><p>(Quellen werden noch nachgearbeitet.) Wiregurad_user systemweit f�r root aufrufbar machen.</p><pre><code>	cp wireguard_user/wireguard_user /sbin/
	chmod a+x /sbin/wireguard_user	
	exit
</code></pre><h3 id="benutzung-vom-terminal-des-svws-servers-aus" tabindex="-1">Benutzung vom terminal des SVWS-Servers aus <a class="header-anchor" href="#benutzung-vom-terminal-des-svws-servers-aus" aria-hidden="true">#</a></h3><p>So k�nnen Sie alle Wirguard-Benutzer auflisten:</p><pre><code>	ssh wireguard -q -l root -t &quot;wireguard_user -l&quot;
</code></pre><h4 id="beispiel-einrichten-des-wireguard-benutzers-test" tabindex="-1">Beispiel: Einrichten des Wireguard-Benutzers <em>test</em>: <a class="header-anchor" href="#beispiel-einrichten-des-wireguard-benutzers-test" aria-hidden="true">#</a></h4><pre><code>	ssh wireguard -q -l root -t &quot;wireguard_user -u test -a&quot;
</code></pre><p>Als R�ckmeldung gibt die Konsole die config datei f�r den Wireguard client aus.</p><p>Alternativ kann diese Konfigurations-Datei auch gespeichert werden:</p><pre><code>	ssh wireguard -q -l root -t &quot;wireguard_user -u test -a&quot; &gt;&gt; test-user.conf
</code></pre><p>Man das config file auch direkt als QR-Code im Terminal angezeigen lassen. Dzu ben�tigt man das tool qrencode</p><pre><code>	apt install qrencode
</code></pre><p>QR Code erzeugen:</p><pre><code>	qrencode -t UTF8 &lt; test-user.conf
</code></pre><p>oder auch alles in Einem:</p><pre><code>	ssh wireguard -q -l root -t &quot;wireguard_user -u test -a&quot; | tee test-user.conf &gt; qrencode -t UTF8
</code></pre><p>bzw. inklusive Speichern des QRcodes und der config Datei:</p><pre><code>	ssh wireguard -q -l root -t &quot;wireguard_user -u test -a&quot; | tee test-user.conf &gt; qrencode -o test-user.png -t PNG
</code></pre><h4 id="beispiel-l�schen-des-users-test" tabindex="-1">Beispiel: L�schen des users <em>test</em>: <a class="header-anchor" href="#beispiel-l�schen-des-users-test" aria-hidden="true">#</a></h4><pre><code>	ssh wireguard -q -l root -t &quot;wireguard_user -u test -d&quot;
</code></pre><hr><h2 id="quellen" tabindex="-1">Quellen: <a class="header-anchor" href="#quellen" aria-hidden="true">#</a></h2><p><a href="https://github.com/angristan/wireguard-install" target="_blank" rel="noopener noreferrer">https://github.com/angristan/wireguard-install</a></p><p><a href="https://www.bennetrichter.de/anleitungen/wireguard-linux/" target="_blank" rel="noopener noreferrer">https://www.bennetrichter.de/anleitungen/wireguard-linux/</a></p><p><a href="https://www.bitblokes.de/wireguard-vpn-server-einrichten-ubuntu-raspberry-pi-linux-android/" target="_blank" rel="noopener noreferrer">https://www.bitblokes.de/wireguard-vpn-server-einrichten-ubuntu-raspberry-pi-linux-android/</a></p><p><a href="https://github.com/angristan/wireguard-install/blob/88ae1c0d0f5d4f48252fd3be27b2f122e40edf83/wireguard-install.sh" target="_blank" rel="noopener noreferrer">https://github.com/angristan/wireguard-install/blob/88ae1c0d0f5d4f48252fd3be27b2f122e40edf83/wireguard-install.sh</a></p><p><a href="https://blog.peterge.de/wireguard-lxc-unter-proxmox/" target="_blank" rel="noopener noreferrer">https://blog.peterge.de/wireguard-lxc-unter-proxmox/</a></p><p><a href="https://www.youtube.com/watch?v=D1zp6n7ushM" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=D1zp6n7ushM</a></p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><!----></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"algorithmen_blockungs-algorithmus_blockungsalgorithmen.md\":\"750e485a\",\"algorithmen_gs_index.md\":\"f7fc9582\",\"entwicklungsumgebungen_eclipse-ubuntu_index.md\":\"9a2997d1\",\"entwicklungsumgebungen_eclipse-windows_index.md\":\"665f342c\",\"entwicklungsumgebungen_eclipse-windows_im_msb_index.md\":\"8808b28b\",\"entwicklungsumgebungen_intellij_index.md\":\"ea713a62\",\"entwicklungsumgebungen_multipass_index.md\":\"b928d8e0\",\"entwicklungsumgebungen_vs-code_index.md\":\"7bae4f16\",\"entwicklungsumgebungen_macos_index.md\":\"6b4e03c0\",\"entwicklungsumgebungen_übersicht_index.md\":\"578ffb2c\",\"faq.md\":\"c2122441\",\"gitlab-server_installation.md\":\"51f99452\",\"gitlab-server_workflow.md\":\"a980b2ed\",\"gitlab-server_index.md\":\"5d9dd5d4\",\"lizenz-informationen_index.md\":\"c6609a8f\",\"projektanforderungen.md\":\"1cc1494e\",\"reporting_index.md\":\"09653467\",\"svws-client_favicon.md\":\"3d012817\",\"svws-client_mitarbeit.md\":\"222a9d2f\",\"svws-client_notenmanager.md\":\"161f97a2\",\"svws-client_wenom.md\":\"151f8167\",\"svws-client_index.md\":\"d393954c\",\"svws-installer_index.md\":\"71d1249c\",\"svws-server-installationen_001_deployment.md\":\"b29438ad\",\"svws-server-installationen_002_installation_svws-server.md\":\"ec73b568\",\"svws-server-installationen_003_update_svws-server.md\":\"53af54e6\",\"svws-server-installationen_004_datenbank_schemata_einfügen.md\":\"1ce1554e\",\"svws-server-installationen_it-umgebung_einrichtung_portfreigabe.md\":\"d20475eb\",\"svws-server-installationen_it-umgebung_einrichtung_proxmox-container.md\":\"bb66d962\",\"svws-server-installationen_it-umgebung_installation_reverseproxy-server.md\":\"7c8d3c36\",\"svws-server-installationen_it-umgebung_installation_vpn-server.md\":\"c70544e5\",\"svws-server-installationen_index.md\":\"a5b6b730\",\"svws-server-installationen_scripts_install-svws-from-scratch.md\":\"67789963\",\"svws-server_index.md\":\"695e8a82\",\"svws-server_svws-base_readme.md\":\"6fd0e715\",\"svws-server_svws-base_schemacsvstatkue_schulver_einlesen.md\":\"f462637e\",\"svws-server_svws-base_schemacsvstatkue_statkue_datumswerte.md\":\"84b7cedc\",\"svws-server_svws-base_schemacsvstatkue_statkue_fachklassen.md\":\"301f257b\",\"svws-server_svws-core-ts_readme.md\":\"71e0be90\",\"svws-server_svws-core_readme.md\":\"f516ebd2\",\"svws-server_svws-db-utils_readme.md\":\"86b12d5c\",\"svws-server_svws-db_tabellenbeschreibung.md\":\"859fafc4\",\"svws-server_svws-db_index.md\":\"f6aebaf5\",\"svws-server_svws-openapi-ts_readme.md\":\"1f782ed6\",\"svws-server_svws-openapi_readme.md\":\"613d2243\",\"svws-server_svws-server-app_readme.md\":\"63e7e55a\",\"svws-server_svws-transpile_readme.md\":\"98867224\",\"svws-ui-framework_bedienkonzept.md\":\"28acd4bb\",\"svws-ui-framework_gui-auswahl.md\":\"e805c73b\",\"svws-ui-framework_styleguide.md\":\"29c7814b\",\"svws-ui-framework_index.md\":\"d4eebd1f\",\"teamordner_tagesordnung_2021_21_03.md\":\"57e27933\",\"index.md\":\"d40d7ea1\"}")</script>
    <script type="module" async src="/assets/app.7749d780.js"></script>
    
  </body>
</html>