import{_ as e,y as r,x as n,W as i}from"./plugin-vue_export-helper.68280688.js";var t="/assets/wireguard_1.15f0f3cd.png";const w='{"title":"Installation des VPN-Servers","description":"","frontmatter":{},"headers":[{"level":2,"title":"Vorbereitungen","slug":"vorbereitungen"},{"level":3,"title":"Auswahl der Maschine","slug":"auswahl-der-maschine"},{"level":3,"title":"Beipiele f\uFFFDr Hardwarel\uFFFDsungen:","slug":"beipiele-f\uFFFDr-hardwarel\uFFFDsungen"},{"level":2,"title":"WireGuard VPN-Server","slug":"wireguard-vpn-server"},{"level":3,"title":"Installation des Debian 11 System","slug":"installation-des-debian-11-system"},{"level":2,"title":"Installation von Wireguard per Script","slug":"installation-von-wireguard-per-script"},{"level":2,"title":"Portfreigabe","slug":"portfreigabe"},{"level":2,"title":"Fernsteuerung per ssh","slug":"fernsteuerung-per-ssh"},{"level":3,"title":"SSH autologin einrichten","slug":"ssh-autologin-einrichten"},{"level":3,"title":"wireguard_user einrichten","slug":"wireguard-user-einrichten"},{"level":3,"title":"Benutzung vom terminal des SVWS-Servers aus","slug":"benutzung-vom-terminal-des-svws-servers-aus"},{"level":2,"title":"Quellen:","slug":"quellen"}],"relativePath":"SVWS-Server-Installationen/IT-Umgebung/Installation_VPN-Server.md","lastUpdated":1649312336116}',a={},s=i(`<h1 id="installation-des-vpn-servers" tabindex="-1">Installation des VPN-Servers <a class="header-anchor" href="#installation-des-vpn-servers" aria-hidden="true">#</a></h1><h2 id="vorbereitungen" tabindex="-1">Vorbereitungen <a class="header-anchor" href="#vorbereitungen" aria-hidden="true">#</a></h2><h3 id="auswahl-der-maschine" tabindex="-1">Auswahl der Maschine <a class="header-anchor" href="#auswahl-der-maschine" aria-hidden="true">#</a></h3><p>Es gibt mehrer M\uFFFDglichkeiten wie ein VPN-Server betrieben werden kann:</p><ul><li>in einer Virtualisierungsumgebung (Proxmox, ESXi, ...)</li><li>im Containersystem (Docker, LXH, ...)</li><li>direkt auf echter Hardware (Raspberry, PC, Server ...)</li><li>im Router (Fritzbox, ...)</li><li>als Teil einer Firewall (OpenSense, ...)</li></ul><h3 id="beipiele-f\uFFFDr-hardwarel\uFFFDsungen" tabindex="-1">Beipiele f\uFFFDr Hardwarel\uFFFDsungen: <a class="header-anchor" href="#beipiele-f\uFFFDr-hardwarel\uFFFDsungen" aria-hidden="true">#</a></h3><p>Hier gibt es mehrer Anbieter, die auch Hardwarel\uFFFDsungen anbieten. Ein paar wenige Beispiele sind hier nach kurzer Suche im Internet exemplarisch zu finden:</p><p>Fritzbox: <br><a href="https://www.computerbild.de/artikel/cb-News-Software-FritzOS-7.39-AVM-integriert-WireGuard-VPN-FritzBox-31230305.html" target="_blank" rel="noopener noreferrer">https://www.computerbild.de/artikel/cb-News-Software-FritzOS-7.39-AVM-integriert-WireGuard-VPN-FritzBox-31230305.html</a></p><p>Shellfire: <br><a href="https://www.shellfire.de/blog/shellfire-box-4k-wireguard-vpn-router-power/" target="_blank" rel="noopener noreferrer">https://www.shellfire.de/blog/shellfire-box-4k-wireguard-vpn-router-power/</a></p><p>OpenSense: <br><a href="https://www.ovpn.com/de/guides/wireguard/opnsense" target="_blank" rel="noopener noreferrer">https://www.ovpn.com/de/guides/wireguard/opnsense</a></p><h2 id="wireguard-vpn-server" tabindex="-1">WireGuard VPN-Server <a class="header-anchor" href="#wireguard-vpn-server" aria-hidden="true">#</a></h2><p>Die Entscheidung f\uFFFDr den Wireguard VPN-Server in der Testumgebung des SVWS-Servers ist aufgrund verschiedener Rahmenbedingungen gefallen:</p><ul><li>performant, da fest im Linux-Kernel verankert</li><li>Open Source</li><li>einfache Installation per Skript</li><li>installierbar auf einem Server oder einer virtuellen Maschine</li><li>ebenfalls als Hardware erh\uFFFDltlich</li><li>einfache Wartung und Konfiguration per script</li><li>m\uFFFDgliche Weiterentwicklung (Konfiguration der VPN-Zug\uFFFDnge von au\uFFFDen)</li></ul><p>Im Weitern wird als Basis eine virtuelle Debian 11 Maschine auf einem Proxmoxsystem verwendet.</p><p>Ebenso ist die installation in einem LXH-Container m\uFFFDglich, jedoch mit einigen Konfigurationen auf dem Muttersystem verbunden, auf die hier nicht weiter eingegangen wird. Die Installation unterscheidet sich im Wesentlichen nicht von anderen Installationen auf anderen Virtualisierungen (ESXi, ...) oder echter Hardware.</p><h3 id="installation-des-debian-11-system" tabindex="-1">Installation des Debian 11 System <a class="header-anchor" href="#installation-des-debian-11-system" aria-hidden="true">#</a></h3><h4 id="download-debian-11-net-install" tabindex="-1">download debian 11 net install: <br> <a class="header-anchor" href="#download-debian-11-net-install" aria-hidden="true">#</a></h4><p><a href="https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-11.1.0-amd64-netinst.iso" target="_blank" rel="noopener noreferrer">https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-11.1.0-amd64-netinst.iso</a></p><p>Eine typische Debian Installation ausf\uFFFDhren - einfach der Menuef\uFFFDhrung folgen und je nach Bedarf auch auf das grafische Frontend verzichten. Den SSH-Server direkt mit installieren, es wird in der Regel der SSH Zugang f\uFFFDr die Wartung ben\uFFFDtigt.</p><h4 id="ggf-aktualisieren" tabindex="-1">ggf aktualisieren <a class="header-anchor" href="#ggf-aktualisieren" aria-hidden="true">#</a></h4><p>Bei einem frisch installierten System sollte dieser Schritt nicht n\uFFFDtig sein, man kann es aber trotzdem einmal ausf\uFFFDhren, um auch die letzten Aktualisierungen geladen zu haben:</p><pre><code>	apt update
	apt upgrade -y
</code></pre><p>N\uFFFDtzliche Helfer installieren:</p><pre><code>	apt install -y nmap curl git net-tools
</code></pre><h4 id="ggf-das-root-login-per-ssh-zulassen" tabindex="-1">ggf das root login per ssh zulassen: <a class="header-anchor" href="#ggf-das-root-login-per-ssh-zulassen" aria-hidden="true">#</a></h4><p>Wenn man eine Fernsteuerung des Wireguard-Servers \uFFFDber SSH zulassen m\uFFFDchte sollte eine Anmeldung per root Account zumindest aus dem lokalen Netz heraus erm\uFFFDglicht werden. Der ssh-root-login ist ohnehin in vielen Debian Installationen schon aktiviert, dies ist jedoch im Grunde ein vermeidbares Sicherheitsrisiko bei Maschinen, die auf diesem Port \uFFFDber das Internet erreichbar sind. Abhilfe schafft hier entweder das Abschalten des rootlogins, eine vorgelagerte Firewall oder die Absicherung zum Beispiel mit <a href="https://www.thomas-krenn.com/de/wiki/SSH_Login_unter_Debian_mit_fail2ban_absichern" target="_blank" rel="noopener noreferrer">fail2ban</a>.</p><p>Falls der ssh-root-login zugelassen werden soll, muss die Datei sshd_config editiert werden:</p><pre><code>	nano /etc/ssh/sshd_config
</code></pre><p>unter der auskommentierten Zeile</p><pre><code>	#PermitRootLogin prohibit-password
</code></pre><p>Folgendes einf\uFFFDgen:</p><pre><code>	PermitRootLogin yes
</code></pre><p>SSH neu starten:</p><pre><code>	sudo service sshd restart
</code></pre><h2 id="installation-von-wireguard-per-script" tabindex="-1">Installation von Wireguard per Script <a class="header-anchor" href="#installation-von-wireguard-per-script" aria-hidden="true">#</a></h2><p>Download des Installationsscrpits und Installation starten:</p><pre><code>	wget https://git.io/wireguard -O wireguard-install.sh &amp;&amp; bash wireguard-install.sh
</code></pre><p>(Quellen werden noch nachgearbeitet.) Als Port kann auch irgendein Port in den h\uFFFDheren Bereichen gew\uFFFDhlt werden, wie hier dargestellt port 58200.</p><p><img src="`+t+`" alt="Wireguard Installation Screenshot"></p><p>(Die Nachfrage zum Installieren von BoringTun erfolgt nur bei LXH-Containern.)</p><h2 id="portfreigabe" tabindex="-1">Portfreigabe <a class="header-anchor" href="#portfreigabe" aria-hidden="true">#</a></h2><p>Um nun den Wireguard-Server aus dem Internet erreichen zu k\uFFFDnnen und dar\uFFFDber eine VPN-Verbindung ins eigene Verwaltungsnetz herzustellen, ben\uFFFDtigt man eine Portfreigabe auf dem Router bzw. der eingesetzten Firewall. Dies muss in der Regel durch den zust\uFFFDndigen IT-Dienstleister eingerichtet werden. Exemplarisch wird hier die <a href="./Einrichtung_Portfreigabe.html">Einrichtung einer Portfreigabe bei einer Fritzbox</a> gezeigt.</p><h2 id="fernsteuerung-per-ssh" tabindex="-1">Fernsteuerung per ssh <a class="header-anchor" href="#fernsteuerung-per-ssh" aria-hidden="true">#</a></h2><p>Die Einrichtung der <em>Fernsteuerung per ssh</em> erm\uFFFDglicht es auf dem SVWS-Server durch Absetzen einfacher Befehle VPN Verbindungen zu verwalten. Im Folgenden wird die Arbeit \uFFFDber die Konsole des SVWS-Servers ausgef\uFFFDhrt.</p><h3 id="ssh-autologin-einrichten" tabindex="-1">SSH autologin einrichten <a class="header-anchor" href="#ssh-autologin-einrichten" aria-hidden="true">#</a></h3><p>Auf dem SVWS-Server als SVWS-Standart-Benutzer einen permanenten ssh Schl\uFFFDssel mit dem Maschine <em>wireguard</em> austauschen:</p><pre><code>	ssh-keygen -t rsa -b 4096
	ssh-copy-id -i ~/.ssh/id_rsa.pub root@wireguard
</code></pre><p>Nun k\uFFFDnnen Root Befehle auf dem Wireguard-Server auch vom SVWS-Server aus abgesetzt werden.</p><h3 id="wireguard-user-einrichten" tabindex="-1">wireguard_user einrichten <a class="header-anchor" href="#wireguard-user-einrichten" aria-hidden="true">#</a></h3><p>Um einfach Wireguard-user einzurichten kann der Befehl wirguard_user benutzt werden. Dieses Skript muss jedoch erst einmal heruntergeladen und als ausf\uFFFDhrbare Datei im Wirguard-Server etabliert werden.</p><pre><code>	ssh root@wireguard
	git clone https://github.com/familie-klein/wireguard_user/
</code></pre><p>(Quellen werden noch nachgearbeitet.) Wiregurad_user systemweit f\uFFFDr root aufrufbar machen.</p><pre><code>	cp wireguard_user/wireguard_user /sbin/
	chmod a+x /sbin/wireguard_user	
	exit
</code></pre><h3 id="benutzung-vom-terminal-des-svws-servers-aus" tabindex="-1">Benutzung vom terminal des SVWS-Servers aus <a class="header-anchor" href="#benutzung-vom-terminal-des-svws-servers-aus" aria-hidden="true">#</a></h3><p>So k\uFFFDnnen Sie alle Wirguard-Benutzer auflisten:</p><pre><code>	ssh wireguard -q -l root -t &quot;wireguard_user -l&quot;
</code></pre><h4 id="beispiel-einrichten-des-wireguard-benutzers-test" tabindex="-1">Beispiel: Einrichten des Wireguard-Benutzers <em>test</em>: <a class="header-anchor" href="#beispiel-einrichten-des-wireguard-benutzers-test" aria-hidden="true">#</a></h4><pre><code>	ssh wireguard -q -l root -t &quot;wireguard_user -u test -a&quot;
</code></pre><p>Als R\uFFFDckmeldung gibt die Konsole die config datei f\uFFFDr den Wireguard client aus.</p><p>Alternativ kann diese Konfigurations-Datei auch gespeichert werden:</p><pre><code>	ssh wireguard -q -l root -t &quot;wireguard_user -u test -a&quot; &gt;&gt; test-user.conf
</code></pre><p>Man das config file auch direkt als QR-Code im Terminal angezeigen lassen. Dzu ben\uFFFDtigt man das tool qrencode</p><pre><code>	apt install qrencode
</code></pre><p>QR Code erzeugen:</p><pre><code>	qrencode -t UTF8 &lt; test-user.conf
</code></pre><p>oder auch alles in Einem:</p><pre><code>	ssh wireguard -q -l root -t &quot;wireguard_user -u test -a&quot; | tee test-user.conf &gt; qrencode -t UTF8
</code></pre><p>bzw. inklusive Speichern des QRcodes und der config Datei:</p><pre><code>	ssh wireguard -q -l root -t &quot;wireguard_user -u test -a&quot; | tee test-user.conf &gt; qrencode -o test-user.png -t PNG
</code></pre><h4 id="beispiel-l\uFFFDschen-des-users-test" tabindex="-1">Beispiel: L\uFFFDschen des users <em>test</em>: <a class="header-anchor" href="#beispiel-l\uFFFDschen-des-users-test" aria-hidden="true">#</a></h4><pre><code>	ssh wireguard -q -l root -t &quot;wireguard_user -u test -d&quot;
</code></pre><hr><h2 id="quellen" tabindex="-1">Quellen: <a class="header-anchor" href="#quellen" aria-hidden="true">#</a></h2><p><a href="https://github.com/angristan/wireguard-install" target="_blank" rel="noopener noreferrer">https://github.com/angristan/wireguard-install</a></p><p><a href="https://www.bennetrichter.de/anleitungen/wireguard-linux/" target="_blank" rel="noopener noreferrer">https://www.bennetrichter.de/anleitungen/wireguard-linux/</a></p><p><a href="https://www.bitblokes.de/wireguard-vpn-server-einrichten-ubuntu-raspberry-pi-linux-android/" target="_blank" rel="noopener noreferrer">https://www.bitblokes.de/wireguard-vpn-server-einrichten-ubuntu-raspberry-pi-linux-android/</a></p><p><a href="https://github.com/angristan/wireguard-install/blob/88ae1c0d0f5d4f48252fd3be27b2f122e40edf83/wireguard-install.sh" target="_blank" rel="noopener noreferrer">https://github.com/angristan/wireguard-install/blob/88ae1c0d0f5d4f48252fd3be27b2f122e40edf83/wireguard-install.sh</a></p><p><a href="https://blog.peterge.de/wireguard-lxc-unter-proxmox/" target="_blank" rel="noopener noreferrer">https://blog.peterge.de/wireguard-lxc-unter-proxmox/</a></p><p><a href="https://www.youtube.com/watch?v=D1zp6n7ushM" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=D1zp6n7ushM</a></p>`,79),d=[s];function l(u,o,h,g,p,c){return n(),r("div",null,d)}var f=e(a,[["render",l]]);export{w as __pageData,f as default};
