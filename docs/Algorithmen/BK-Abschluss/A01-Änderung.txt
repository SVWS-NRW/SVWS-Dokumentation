Änderung A01 FOR-Vergab erst nach IHK-Nachweis


function TBKPruefungsAlgorithmus.Pruefe_APO_BK_15_A_FK_Abschluss: string;

// A01, Berufsschule Teilzeit, normale Fachklasse

const

                MsgNeg = 'Kein Abschluss:';

var

                msg, idf: string;

                i : integer;

                DSN : Double;

  diff_ber, cmd: string;

  abschl, abschl_bb: string;

begin

                Result := 'N';

                msg := '';

 

// Differenzierungsbereich raus

// Neu 30.1.2011: Diff-Bereich nur temporär entfernen

 

  diff_ber := FeldWertIDs( fC0, 'Fachgruppe_ID', '30', 0 );

  Uebertragen( fC0, fC1, diff_ber );                        // von C0 nach C1

 

  try

  // Anzahl Noten = 6 > 0?

    idf := NoteVorhanden( fC0, 'Note', '=', 6, -1 );

    if AnzahlElemente( idf ) > 0 then

    begin // ein oder mehr 6

      for i := 1 to AnzahlElemente( idf ) do

        StrAdd( SchreibeFachNote( fC0, StrToInt( GetToken( idf, ';', i ) ) ), msg );

      Meldung( 'Ergebnis:' );

      VersetzungsMeldung( MsgNeg, msg );

      FAbgangsart := '0A';

      FBildungsgang := 'B';

      AbschlussSpeichern( 2 );

      FBildungsgang := 'A';

      AbschlussSpeichern( 2 );

      exit; // keine weitere Behandlung

    end;

 

  // Anzahl Noten = 5 > 2?

    idf := NoteVorhanden( fC0, 'Note', '=', 5, -1 );

    if AnzahlElemente( idf ) >=2  then                      // ggfs. Nachprüfung?

    begin // zwei oder mehr 5

      for i := 1 to NumToken( idf, ';' ) do

        StrAdd( SchreibeFachNote( fC0, StrToInt( GetToken( idf, ';', i ) ) ), msg );

      Meldung( 'Ergebnis:' );

      VersetzungsMeldung( MsgNeg, msg );

      FAbgangsart := '0A'; // kein Abschluss

      FBildungsgang := 'B';

      AbschlussSpeichern( 2 );

      FBildungsgang := 'A';

      AbschlussSpeichern( 2 );

      exit; // keine weitere Behandlung

    end;

 

// Wenn wir hier sind, hat der Schüler den BA bestanden

 

    DSN := BK_NotenDurchschnitt( fC0, 0, 'Note' );

 

    DurchschnittsNoteSpeichern( DSN, 'Durchschnittsnote', 'DSN_Text' );

 

    Meldung( 'Ergebnis:' );

 

    abschl := POJahrErsetzen( 'APO-BK-15/A-FK/BSA' );

 

// A: Abgangszeugnis ohne AbschlussAbgangszeugnis ohne Abschluss

// B: Hauptschulabschluss

// C: Hauptschulabschluss mit Berechtigung zum Besuch der Klasse 10, Typ B

 

    Meldung( Format( '%s (Durchschnittsnote %s)', [ 'Berufsschulabschluss', FloatToStr( DSN ) ] ) );

 

  // Jetzt den allg.-bildeneden Abschluss in Abh. der Eingangsvoraussetzung speichern

    FBildungsGang := 'A';

    FBerufsabschluss := true;

    cmd := Format( 'update Schueler set Berufsabschluss=%s where ID=%d', [ QuotedStr( '+' ), fS_ID ] );

    TransactionHandler.DoExecute( cmd );

 

// NEU: Fallunterscheidungen

    abschl_bb := 'APO-BK-15/A-FK/BSA';

    if ReferenzNiveauVorhanden( 'B1' ) then

    begin // Englisch ausreichend vorhanden

      if FBAP_Vorhanden and ( DSN <= 2.5 ) then

      begin

        abschl := POJahrErsetzen( 'APO-BK-15/A-FK/FGO' );

        AbschlussErgebnisSpeichern( bwBestanden, bwBestanden, abschl, abschl_bb, '3G', 'Zusatzqualifikation FOR mit Q.V.' );

      end else if FBAP_Vorhanden and ( DSN <= 3.0 ) then

      begin

        abschl := POJahrErsetzen( 'APO-BK-15/A-FK/FOR' );

        AbschlussErgebnisSpeichern( bwBestanden, bwBestanden, abschl, abschl_bb, '3F','Zusatzqualifikation FOR ohne Q.V.' );

      end else

      begin

        abschl := POJahrErsetzen( 'APO-BK-15/A-FK/HSA' );

        AbschlussErgebnisSpeichern( bwBestanden, bwBestanden, abschl, abschl_bb, '3D','' );

        if FBAP_Vorhanden then

          Meldung( 'HSA, keine weitere Zusatzqualifikation (Grund: Durchschnittsnote)' )

        else

          Meldung( 'HSA, keine weitere Zusatzqualifikation (Grund: Keine Berufsabschlussprüfung)' );

      end;

    end else

    begin  // Englisch nicht ausreichend vorhanden

      if FBAP_Vorhanden and ( DSN <= 2.5 ) then

      begin

        abschl := POJahrErsetzen( 'APO-BK-15/A-FK/HSA' );

        AbschlussErgebnisSpeichern( bwBestanden, bwBestanden, abschl, abschl_bb, '3D','' );

        Meldung( 'HSA, bei Nachweis der notwendigen Englischkenntnisse ist FOR-Q möglich!' );

      end else if FBAP_Vorhanden and ( DSN <= 3.0 ) then

      begin

        abschl := POJahrErsetzen( 'APO-BK-15/A-FK/HSA' );

        AbschlussErgebnisSpeichern( bwBestanden, bwBestanden, abschl, abschl_bb, '3D', '' );

        Meldung( 'HSA, bei Nachweis der notwendigen Englischkenntnisse ist FOR möglich!');

      end else

      begin

        abschl := POJahrErsetzen( 'APO-BK-15/A-FK/HSA' );

        AbschlussErgebnisSpeichern( bwBestanden, bwBestanden, abschl, abschl_bb, '3D', '' );

        if FBAP_Vorhanden then

          Meldung( 'HSA, keine weitere Zusatzqualifikation (Grund: Durchschnittsnote)' )

        else

          Meldung( 'HSA, keine weitere Zusatzqualifikation (Grund: Keine Berufsabschlussprüfung)' );

      end;

    end;

    Result := 'A';

  finally

// Neu 30.1.2011: Diff-Bereich nur temporär entfernen

    Uebertragen( fC1, fC0, diff_ber );                      // Diff wieder zurück

  end;

end;